<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='Facturador_Logo.jpg') }}" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
    <div class="pantalla_exito pantalla_exito-hidden">
        <p id="mensaje_exito" class="confirmacion-accion">Nota realizada exitosamente Exitosamente</p>
        <form id="formulario_exito" action="/menu_facturador" method="POST" onsubmit="mostrarLoader(event)" style="display: none;">
            <h5 style="display: inline-block;">
                <button type="submit" name="accion" value="FM" class="boton">Aceptar</button>
            </h5>
        </form>
    </div>
    <body>
    <!--Seccion de enlaces y acceso directo-->
    <section class="AccesoDirecto">
        <div class="container navbar">
            <nav class="navbar-expand-lg fixed-top" id="barraDeNavegacion">
				<div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-center" id="navbarNav"> 
                        <ul class="navbar-nav"> 
                                    <li class="nav-item"> <a class="nav-link" href="{{url_for('menu_facturador_')}}"><h6 class="barraNavegacion">Menu Facturación</h6></a></li>
                                    <li class="nav-item"> <a class="nav-link" href="{{url_for('documentacion')}}" target="_blank"><h6 class="barraNavegacion">Documentación y Tutoriales</h6></a></li>
                                    <li class="nav-item"> <a class="nav-link" href="{{url_for('sis_info')}}" target="_blank"><h6 class="barraNavegacion">Información sobre el sistema</h6></a></li>
                                    <li class="nav-item"> <a class="nav-link" href="{{url_for('ayuda')}}" target="_blank"><h6 class="barraNavegacion">Ayuda</h6></a></li>
                                    <li class="nav-item"> <button id="toggleTheme" class="nav-link"><h6 class="barraNavegacion">Cambiar tema</h6></button></li>
                                </ul>
                            </div>
                    </div>
                </nav>
            </div>
        </section>
        <!---->
        <div class="marco_div">
            <h1>Historial - Notas de Crédito</h1>
                <h3>¿Como usar el historial y hacer notas de crédito?</h3>
                <p>Seguí el tutorial a continuación para aprender a usar el historial y como hacer notas de crédito</p>
                <div class="responsive-video">  
                    <iframe src="https://www.youtube.com/embed/m7WjqMNwoAE" title="Historial y Hacer Nota Crédito" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                </div>  
            <h2>Elegí lo que querés hacer:</h2>
            <div class="toggle-buttons">
                    <h5><button class="toggle boton" style="display: inline-block;" id="button" onclick="changeContent(1)">Ver historial</button>
                        <button class="toggle boton" style="display: inline-block;" id="button" onclick="changeContent(2)">Hacer una nota de crédito</button>
                    </h5>
                </div>
            <div class="marco_div content-item" id="content-1">
                <form action="/rearmar_pdf" method="POST" style="text-align: center;" onsubmit="mostrarExito1(event)">
                    <div class="texto_default">
                        <label for="search-box">Buscar Identificador Factura:</label>
                        <input type="text" id="search-box-1" oninput="filterItems(1)" placeholder="ID Factura">
                        <p>(Si no ves uno de estos campos en tus productos o servicios significa que no lo tenía al momento de realizar la facturación/nota)</p>
                    </div>
                    <div style="overflow-x: auto;">
                        <div id="items-container-1">
                            <table class="tabla-centrada">
                                <thead>
                                    <tr>
                                        <th>Descargar PDF</th>
                                        <th>Identificador Factura</th>
                                        <th>Tipo Factura/Nota</th>
                                        <th>Tipo de Documento</th>
                                        <th>Numero de documento cliente</th>
                                        <th>Nombre y apellido cliente</th>
                                        <th>Telefono</th>
                                        <th>Provincia</th>
                                        <th>Localidad</th>
                                        <th>Domicilio</th>
                                        <th>Condicion de venta cliente</th>
                                        <th>Condicion IVA cliente</th>
                                        <th>Concepto</th>
                                        <th>Fecha Servicio Desde</th>
                                        <th>Fecha Servicio Hasta</th>
                                        <th>Fecha Vencimiento de pago</th>
                                        <th>Producto/Servicio</th>
                                        <th>Porcentaje Bonificado</th>
                                        <th>Cantidad</th>
                                        <th>Codigo Producto</th>
                                        <th>Descripcion</th>
                                        <th>Precio unitario</th>
                                        <th>Impuesto Adicional</th>
                                        <th>Importe Bonificado</th>
                                        <th>Subtotal</th>
                                        <th>Importe Neto</th>
                                        <th>Importe Total</th>
                                        <th>Importe Tributo</th>
                                        <th>Descripcion Impuesto adicional</th>
                                        <th>Alicuota Impuesto Adicional</th>
                                        <th>Nombre Apellido Vendedor</th>
                                        <th>CUIT Vendedor</th>
                                        <th>Nombre Empresa</th>
                                        <th>Punto de venta</th>
                                        <th>Razon Social</th>
                                        <th>Domicilio</th>
                                        <th>Condicion Frente al IVA</th>
                                        <th>Ingresos Brutos</th>
                                        <th>Fecha Inicio</th>
                                        <th>Impuesto Adicional Global</th>
                                        <th>Descripcion impuesto adicional global</th>
                                        <th>Alicuota</th>
                                        <th>CAE NÚMERO</th>
                                        <th>CAE FECHA VENCIMIENTO</th>
                                        <th>Número de comprobante</th>
                                        <th>Base 21%</th>
                                        <th>Base 10.5%</th>
                                        <th>Base 0%</th>
                                        <th>IVA 21%</th>
                                        <th>IVA 10.5%</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    {% for fila in historial %}
                                        {% set fila_json = fila|tojson %}
                                        {% set clave = fila[0] if fila|length > 0 and fila[0] is not none else '' %}
                                        <tr class="checkbox" data-name="{{ clave }}">
                                            <!-- Botón Hacer Nota -->
                                            <td>
                                                <input type="hidden" name="selected_items_json" value='{{ fila_json|safe }}'>
                                                <button type="submit" class="btn btn-primary">Descargar PDF</button>
                                            </td>

                                            <!-- Identificador Factura -->
                                            <td>{{ clave }}</td>

                                            <!-- Resto de columnas dinámicas -->
                                            {% for celda in fila[1:] %}
                                                <td>{{ celda if celda is not none else "" }}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <div class="content-item" id="content-2">
                <form action="/facturacion" method="POST" style="text-align: center;" onsubmit="mostrarExito2(event)">
                    <div class="texto_default">
                        <label for="search-box">Buscar Identificador Factura:</label>
                        <input type="text" id="search-box-2" oninput="filterItems(2)" placeholder="ID Factura">
                        <p>(Si no ves uno de estos campos en tus productos o servicios significa que no lo tenía al momento de realizar la facturación/nota)</p>
                        <p>No se puden hacer Notas de Credito pasados los 15 dias de la emision de la factura</p>
                    </div>

                    <div style="overflow-x: auto;">
                        <input type="hidden" id="search-box-factura" value="factura">
                        <div id="items-container-2">
                            <table class="tabla-centrada">
                                <thead>
                                    <tr>
                                        <th>Hacer Nota de Crédito</th>
                                        <th>Identificador Factura</th>
                                        <th>Tipo Factura/Nota</th>
                                        <th>Tipo de Documento</th>
                                        <th>Numero de documento cliente</th>
                                        <th>Nombre y apellido cliente</th>
                                        <th>Telefono</th>
                                        <th>Provincia</th>
                                        <th>Localidad</th>
                                        <th>Domicilio</th>
                                        <th>Condicion de venta cliente</th>
                                        <th>Condicion IVA cliente</th>
                                        <th>Concepto</th>
                                        <th>Fecha Servicio Desde</th>
                                        <th>Fecha Servicio Hasta</th>
                                        <th>Fecha Vencimiento de pago</th>
                                        <th>Producto/Servicio</th>
                                        <th>Porcentaje Bonificado</th>
                                        <th>Cantidad</th>
                                        <th>Codigo Producto</th>
                                        <th>Descripcion</th>
                                        <th>Precio unitario</th>
                                        <th>Impuesto Adicional</th>
                                        <th>Importe Bonificado</th>
                                        <th>Subtotal</th>
                                        <th>Importe Neto</th>
                                        <th>Importe Total</th>
                                        <th>Importe Tributo</th>
                                        <th>Descripcion Impuesto adicional</th>
                                        <th>Alicuota Impuesto Adicional</th>
                                        <th>Nombre Apellido Vendedor</th>
                                        <th>CUIT Vendedor</th>
                                        <th>Nombre Empresa</th>
                                        <th>Punto de venta</th>
                                        <th>Razon Social</th>
                                        <th>Domicilio</th>
                                        <th>Condicion Frente al IVA</th>
                                        <th>Ingresos Brutos</th>
                                        <th>Fecha Inicio</th>
                                        <th>Impuesto Adicional Global</th>
                                        <th>Descripcion impuesto adicional global</th>
                                        <th>Alicuota</th>
                                        <th>CAE NÚMERO</th>
                                        <th>CAE FECHA VENCIMIENTO</th>
                                        <th>Número de comprobante</th>
                                        <th>Base 21%</th>
                                        <th>Base 10.5%</th>
                                        <th>Base 0%</th>
                                        <th>IVA 21%</th>
                                        <th>IVA 10.5%</th>
                                    </tr>
                                </thead>
                                <tbody id="items-container-facturas">
                                    {% for fila in historial %}
                                        {% set fila_json = fila|tojson %}
                                        {% set clave = fila[0] if fila|length > 0 and fila[0] is not none else '' %}
                                        <tr class="checkbox" data-name="{{ clave }}">
                                            <td>
                                                <input type="hidden" name="modo_facturacion" value="Nota Credito">
                                                <input type="hidden" name="selected_items_json" value='{{ fila_json|safe }}'>
                                                <button type="submit" class="btn btn-primary">Hacer Nota</button>
                                            </td>
                                            <td>{{ clave }}</td>
                                            {% for celda in fila[1:] %}
                                                <td>{{ celda if celda is not none else "" }}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <script src="{{ url_for('static', filename='js/historial.js') }}" defer></script>
        <script src="{{ url_for('static', filename='js/visual/cambiar_tema.js') }}"></script>
    </body>
</html>